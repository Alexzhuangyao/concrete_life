# ç‰©æ–™ç®¡ç†æ¨¡å—æ–‡æ¡£

## ğŸ“¦ æ¨¡å—æ¦‚è¿°

ç‰©æ–™ç®¡ç†æ¨¡å—è´Ÿè´£ç®¡ç†æ··å‡åœŸæ…æ‹Œç«™çš„æ‰€æœ‰åŸææ–™ï¼ŒåŒ…æ‹¬æ°´æ³¥ã€ç ‚çŸ³ã€å¤–åŠ å‰‚ç­‰ã€‚æä¾›ææ–™ä¿¡æ¯ç®¡ç†ã€åº“å­˜ç®¡ç†ã€ä¾›åº”å•†ç®¡ç†ç­‰åŠŸèƒ½ã€‚

**å®Œæˆæ—¶é—´**: 2026-01-26  
**çŠ¶æ€**: âœ… å·²å®Œæˆ  
**ç‰ˆæœ¬**: v1.0.0

---

## ğŸ¯ åŠŸèƒ½ç‰¹æ€§

### æ ¸å¿ƒåŠŸèƒ½

1. **åŸææ–™ç®¡ç†**
   - âœ… åˆ›å»ºææ–™ä¿¡æ¯
   - âœ… æŸ¥è¯¢ææ–™åˆ—è¡¨ï¼ˆåˆ†é¡µã€ç­›é€‰ã€æ’åºï¼‰
   - âœ… æŸ¥è¯¢å•ä¸ªææ–™è¯¦æƒ…
   - âœ… æ›´æ–°ææ–™ä¿¡æ¯
   - âœ… åˆ é™¤ææ–™ï¼ˆè½¯åˆ é™¤ï¼‰
   - âœ… ä½åº“å­˜é¢„è­¦

2. **åº“å­˜ç®¡ç†**
   - âœ… å…¥åº“è®°å½•
   - âœ… å‡ºåº“è®°å½•
   - âœ… åº“å­˜æŸ¥è¯¢
   - âœ… åº“å­˜ç»Ÿè®¡
   - âœ… åº“å­˜å˜åŠ¨è¿½è¸ª

3. **ä¾›åº”å•†ç®¡ç†**
   - âœ… ä¾›åº”å•†ä¿¡æ¯ç®¡ç†
   - âœ… ä¾›åº”å•†åˆ†ç±»
   - âœ… ä¿¡ç”¨ç­‰çº§ç®¡ç†
   - âœ… ä¾›åº”å•†ç»Ÿè®¡

---

## ğŸ“‹ ææ–™ç±»å‹è¯´æ˜

### ææ–™ç±»å‹åˆ—è¡¨

| ç±»å‹ | è¯´æ˜ | å•ä½ç¤ºä¾‹ |
|------|------|---------|
| `cement` | æ°´æ³¥ | å¨ |
| `sand` | ç ‚ | ç«‹æ–¹ç±³ |
| `stone` | çŸ³å­ | ç«‹æ–¹ç±³ |
| `water` | æ°´ | ç«‹æ–¹ç±³ |
| `admixture` | å¤–åŠ å‰‚ | åƒå…‹ |
| `other` | å…¶ä»– | - |

### ä¾›åº”å•†ç±»å‹

| ç±»å‹ | è¯´æ˜ |
|------|------|
| `cement` | æ°´æ³¥ä¾›åº”å•† |
| `sand` | ç ‚çŸ³ä¾›åº”å•† |
| `stone` | çŸ³æ–™ä¾›åº”å•† |
| `admixture` | å¤–åŠ å‰‚ä¾›åº”å•† |
| `comprehensive` | ç»¼åˆä¾›åº”å•† |
| `other` | å…¶ä»– |

### ä¿¡ç”¨ç­‰çº§

| ç­‰çº§ | è¯´æ˜ |
|------|------|
| `A` | ä¼˜ç§€ |
| `B` | è‰¯å¥½ |
| `C` | ä¸€èˆ¬ |
| `D` | è¾ƒå·® |

---

## ğŸ”Œ API æ¥å£

### ææ–™ç®¡ç†æ¥å£

#### åŸºç¡€è·¯å¾„: `/api/materials`

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ | æƒé™ |
|------|------|------|------|
| POST | `/api/materials` | åˆ›å»ºææ–™ | admin, manager |
| GET | `/api/materials` | æŸ¥è¯¢ææ–™åˆ—è¡¨ | éœ€ç™»å½• |
| GET | `/api/materials/statistics` | è·å–ææ–™ç»Ÿè®¡ | éœ€ç™»å½• |
| GET | `/api/materials/low-stock` | è·å–ä½åº“å­˜ææ–™ | éœ€ç™»å½• |
| GET | `/api/materials/:id` | æŸ¥è¯¢å•ä¸ªææ–™ | éœ€ç™»å½• |
| PATCH | `/api/materials/:id` | æ›´æ–°ææ–™ | admin, manager |
| DELETE | `/api/materials/:id` | åˆ é™¤ææ–™ | admin, manager |

### åº“å­˜ç®¡ç†æ¥å£

#### åŸºç¡€è·¯å¾„: `/api/inventory`

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ | æƒé™ |
|------|------|------|------|
| POST | `/api/inventory/records` | åˆ›å»ºåº“å­˜è®°å½• | admin, manager, operator |
| GET | `/api/inventory/records` | æŸ¥è¯¢åº“å­˜è®°å½• | éœ€ç™»å½• |
| GET | `/api/inventory/statistics` | è·å–åº“å­˜ç»Ÿè®¡ | éœ€ç™»å½• |
| GET | `/api/inventory/records/:id` | æŸ¥è¯¢å•ä¸ªè®°å½• | éœ€ç™»å½• |

### ä¾›åº”å•†ç®¡ç†æ¥å£

#### åŸºç¡€è·¯å¾„: `/api/suppliers`

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ | æƒé™ |
|------|------|------|------|
| POST | `/api/suppliers` | åˆ›å»ºä¾›åº”å•† | admin, manager |
| GET | `/api/suppliers` | æŸ¥è¯¢ä¾›åº”å•†åˆ—è¡¨ | éœ€ç™»å½• |
| GET | `/api/suppliers/statistics` | è·å–ä¾›åº”å•†ç»Ÿè®¡ | éœ€ç™»å½• |
| GET | `/api/suppliers/:id` | æŸ¥è¯¢å•ä¸ªä¾›åº”å•† | éœ€ç™»å½• |
| PATCH | `/api/suppliers/:id` | æ›´æ–°ä¾›åº”å•† | admin, manager |
| DELETE | `/api/suppliers/:id` | åˆ é™¤ä¾›åº”å•† | admin, manager |

---

## ğŸ“ è¯·æ±‚ç¤ºä¾‹

### 1. åˆ›å»ºææ–™

```bash
POST /api/materials
```

**è¯·æ±‚ä½“**:
```json
{
  "siteId": 1,
  "name": "P.O 42.5æ°´æ³¥",
  "type": "cement",
  "unit": "å¨",
  "price": 450,
  "stockQuantity": 100,
  "minStock": 20,
  "maxStock": 500,
  "supplierId": 1,
  "specifications": "ç¬¦åˆGB175-2007æ ‡å‡†",
  "remarks": "ä¸»è¦ç”¨äºC30ä»¥ä¸Šæ··å‡åœŸ"
}
```

### 2. åˆ›å»ºå…¥åº“è®°å½•

```bash
POST /api/inventory/records
```

**è¯·æ±‚ä½“**:
```json
{
  "materialId": 1,
  "type": "in",
  "quantity": 50,
  "unitPrice": 450,
  "remarks": "é‡‡è´­å…¥åº“"
}
```

### 3. åˆ›å»ºä¾›åº”å•†

```bash
POST /api/suppliers
```

**è¯·æ±‚ä½“**:
```json
{
  "name": "XXæ°´æ³¥æœ‰é™å…¬å¸",
  "contactPerson": "å¼ ä¸‰",
  "phone": "13800138000",
  "email": "zhangsan@example.com",
  "address": "åŒ—äº¬å¸‚æœé˜³åŒºXXè·¯XXå·",
  "type": "cement",
  "creditRating": "A",
  "remarks": "é•¿æœŸåˆä½œä¾›åº”å•†"
}
```

---

## ğŸ“ æ–‡ä»¶ç»“æ„

```
concrete-plant-api/src/
â”œâ”€â”€ materials/
â”‚   â”œâ”€â”€ dto/
â”‚   â”‚   â”œâ”€â”€ create-material.dto.ts
â”‚   â”‚   â”œâ”€â”€ update-material.dto.ts
â”‚   â”‚   â””â”€â”€ query-material.dto.ts
â”‚   â”œâ”€â”€ materials.controller.ts
â”‚   â”œâ”€â”€ materials.service.ts
â”‚   â””â”€â”€ materials.module.ts
â”‚
â”œâ”€â”€ inventory/
â”‚   â”œâ”€â”€ dto/
â”‚   â”‚   â”œâ”€â”€ create-inventory-record.dto.ts
â”‚   â”‚   â””â”€â”€ query-inventory-record.dto.ts
â”‚   â”œâ”€â”€ inventory.controller.ts
â”‚   â”œâ”€â”€ inventory.service.ts
â”‚   â””â”€â”€ inventory.module.ts
â”‚
â””â”€â”€ suppliers/
    â”œâ”€â”€ dto/
    â”‚   â”œâ”€â”€ create-supplier.dto.ts
    â”‚   â”œâ”€â”€ update-supplier.dto.ts
    â”‚   â””â”€â”€ query-supplier.dto.ts
    â”œâ”€â”€ suppliers.controller.ts
    â”œâ”€â”€ suppliers.service.ts
    â””â”€â”€ suppliers.module.ts
```

---

## ğŸ”’ æƒé™æ§åˆ¶

### è§’è‰²æƒé™çŸ©é˜µ

| æ“ä½œ | admin | manager | operator | driver | quality |
|------|-------|---------|----------|--------|---------|
| åˆ›å»ºææ–™ | âœ… | âœ… | âŒ | âŒ | âŒ |
| æŸ¥è¯¢ææ–™ | âœ… | âœ… | âœ… | âœ… | âœ… |
| æ›´æ–°ææ–™ | âœ… | âœ… | âŒ | âŒ | âŒ |
| åˆ é™¤ææ–™ | âœ… | âœ… | âŒ | âŒ | âŒ |
| å…¥åº“/å‡ºåº“ | âœ… | âœ… | âœ… | âŒ | âŒ |
| æŸ¥çœ‹ç»Ÿè®¡ | âœ… | âœ… | âœ… | âœ… | âœ… |
| ç®¡ç†ä¾›åº”å•† | âœ… | âœ… | âŒ | âŒ | âŒ |

---

## âœ… æ•°æ®éªŒè¯

### åˆ›å»ºææ–™éªŒè¯è§„åˆ™

| å­—æ®µ | ç±»å‹ | å¿…å¡« | éªŒè¯è§„åˆ™ |
|------|------|------|---------|
| siteId | number | âœ… | å¿…é¡»å­˜åœ¨çš„ç«™ç‚¹ID |
| name | string | âœ… | ä¸èƒ½ä¸ºç©ºï¼ŒåŒç«™ç‚¹å†…å”¯ä¸€ |
| type | enum | âœ… | cement/sand/stone/water/admixture/other |
| unit | string | âœ… | ä¸èƒ½ä¸ºç©º |
| price | number | âŒ | å¿…é¡»å¤§äºç­‰äº0 |
| stockQuantity | number | âŒ | å¿…é¡»å¤§äºç­‰äº0ï¼Œé»˜è®¤0 |
| minStock | number | âŒ | å¿…é¡»å¤§äºç­‰äº0ï¼Œé»˜è®¤0 |
| maxStock | number | âŒ | å¿…é¡»å¤§äºç­‰äº0 |
| supplierId | number | âŒ | å¦‚æœæä¾›ï¼Œå¿…é¡»å­˜åœ¨çš„ä¾›åº”å•†ID |

---

## ğŸ”„ ä¸šåŠ¡æµç¨‹

### ææ–™é‡‡è´­å…¥åº“æµç¨‹

```
1. åˆ›å»ºé‡‡è´­è®¢å•
   â†“
2. ä¾›åº”å•†å‘è´§
   â†“
3. ææ–™åˆ°è´§éªŒæ”¶
   â†“
4. åˆ›å»ºå…¥åº“è®°å½•
   â†“
5. ç³»ç»Ÿè‡ªåŠ¨æ›´æ–°åº“å­˜
   â†“
6. ç”Ÿæˆå…¥åº“å•æ®
```

### ææ–™å‡ºåº“æµç¨‹

```
1. ç”Ÿäº§ä»»åŠ¡éœ€è¦ææ–™
   â†“
2. æ£€æŸ¥åº“å­˜æ˜¯å¦å……è¶³
   â†“
3. åˆ›å»ºå‡ºåº“è®°å½•
   â†“
4. ç³»ç»Ÿè‡ªåŠ¨æ‰£å‡åº“å­˜
   â†“
5. ç”Ÿæˆå‡ºåº“å•æ®
   â†“
6. æ£€æŸ¥æ˜¯å¦ä½äºæœ€å°åº“å­˜
   â†“
7. è§¦å‘ä½åº“å­˜é¢„è­¦ï¼ˆå¦‚æœéœ€è¦ï¼‰
```

---

## ğŸ“Š æ•°æ®åº“å…³ç³»

### å…³è”è¡¨

- `materials` - ææ–™ä¸»è¡¨
- `suppliers` - ä¾›åº”å•†è¡¨
- `inventory_records` - åº“å­˜è®°å½•è¡¨
- `sites` - ç«™ç‚¹è¡¨
- `users` - ç”¨æˆ·è¡¨

### å¤–é”®å…³ç³»

```sql
materials.site_id â†’ sites.id
materials.supplier_id â†’ suppliers.id
materials.created_by â†’ users.id
inventory_records.material_id â†’ materials.id
inventory_records.operator_id â†’ users.id
suppliers.created_by â†’ users.id
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### ä¸šåŠ¡è§„åˆ™

1. **ææ–™åç§°å”¯ä¸€æ€§**: åŒä¸€ç«™ç‚¹å†…ææ–™åç§°å¿…é¡»å”¯ä¸€
2. **åˆ é™¤é™åˆ¶**: æœ‰åº“å­˜çš„ææ–™ä¸èƒ½åˆ é™¤
3. **åº“å­˜ç®¡ç†**: å‡ºåº“æ—¶å¿…é¡»æ£€æŸ¥åº“å­˜æ˜¯å¦å……è¶³
4. **ä½åº“å­˜é¢„è­¦**: å½“åº“å­˜ä½äºæœ€å°åº“å­˜æ—¶è§¦å‘é¢„è­¦
5. **ä¾›åº”å•†åˆ é™¤**: æœ‰å…³è”ææ–™çš„ä¾›åº”å•†ä¸èƒ½åˆ é™¤

### æ€§èƒ½ä¼˜åŒ–

1. **åˆ†é¡µæŸ¥è¯¢**: é»˜è®¤æ¯é¡µ10æ¡ï¼Œå»ºè®®ä¸è¶…è¿‡100æ¡
2. **ç´¢å¼•ä¼˜åŒ–**: ææ–™åç§°ã€ç±»å‹ã€ç«™ç‚¹IDå·²å»ºç«‹ç´¢å¼•
3. **äº‹åŠ¡å¤„ç†**: åº“å­˜å˜åŠ¨ä½¿ç”¨äº‹åŠ¡ç¡®ä¿æ•°æ®ä¸€è‡´æ€§
4. **è½¯åˆ é™¤**: ä½¿ç”¨ deleted_at å­—æ®µå®ç°è½¯åˆ é™¤

---

## ğŸš€ åç»­ä¼˜åŒ–å»ºè®®

### çŸ­æœŸä¼˜åŒ–

1. **æ‰¹é‡æ“ä½œ**: æ”¯æŒæ‰¹é‡å…¥åº“/å‡ºåº“
2. **åº“å­˜ç›˜ç‚¹**: å®šæœŸåº“å­˜ç›˜ç‚¹åŠŸèƒ½
3. **é‡‡è´­å»ºè®®**: åŸºäºæ¶ˆè€—é€Ÿåº¦çš„é‡‡è´­å»ºè®®
4. **ä»·æ ¼å†å²**: è®°å½•ææ–™ä»·æ ¼å˜åŠ¨å†å²

### ä¸­æœŸä¼˜åŒ–

5. **ä¾›åº”å•†è¯„ä»·**: ä¾›åº”å•†è¯„ä»·å’Œè¯„åˆ†ç³»ç»Ÿ
6. **åˆåŒç®¡ç†**: é‡‡è´­åˆåŒç®¡ç†
7. **è´¨æ£€è®°å½•**: ææ–™è´¨æ£€è®°å½•
8. **æˆæœ¬åˆ†æ**: ææ–™æˆæœ¬åˆ†æå’Œå¯¹æ¯”

### é•¿æœŸä¼˜åŒ–

9. **æ™ºèƒ½é¢„è­¦**: AIé¢„æµ‹åº“å­˜éœ€æ±‚
10. **ä¾›åº”é“¾ä¼˜åŒ–**: ä¾›åº”é“¾ç®¡ç†ä¼˜åŒ–
11. **ç§»åŠ¨ç«¯**: ç§»åŠ¨ç«¯åº“å­˜ç®¡ç†
12. **æ¡ç ç®¡ç†**: æ¡ç /äºŒç»´ç ç®¡ç†

---

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### å‰ç«¯é›†æˆç¤ºä¾‹

```typescript
// åˆ›å»ºææ–™
const createMaterial = async (materialData) => {
  const response = await fetch('/api/materials', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${token}`,
    },
    body: JSON.stringify(materialData),
  });
  return response.json();
};

// å…¥åº“æ“ä½œ
const stockIn = async (recordData) => {
  const response = await fetch('/api/inventory/records', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${token}`,
    },
    body: JSON.stringify({
      ...recordData,
      type: 'in',
    }),
  });
  return response.json();
};

// æŸ¥è¯¢ä½åº“å­˜ææ–™
const fetchLowStockMaterials = async (siteId) => {
  const response = await fetch(`/api/materials/low-stock?siteId=${siteId}`, {
    headers: {
      'Authorization': `Bearer ${token}`,
    },
  });
  return response.json();
};
```

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ï¼š
- å®Œæ•´æ–‡æ¡£ï¼š`MATERIALS_MODULE_README.md`
- æµ‹è¯•è„šæœ¬ï¼š`test-scripts/test-materials.sh`ï¼ˆå¾…åˆ›å»ºï¼‰
- APIæ–‡æ¡£ï¼š`/api/docs`ï¼ˆå¦‚å·²é…ç½®Swaggerï¼‰

---

**æœ€åæ›´æ–°**: 2026-01-26  
**ç‰ˆæœ¬**: v1.0.0  
**çŠ¶æ€**: âœ… å¼€å‘å®Œæˆï¼Œå¾…æµ‹è¯•
