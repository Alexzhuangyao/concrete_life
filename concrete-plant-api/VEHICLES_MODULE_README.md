# è®¾å¤‡ç®¡ç†æ¨¡å—æ–‡æ¡£

## ğŸ“¦ æ¨¡å—æ¦‚è¿°

è®¾å¤‡ç®¡ç†æ¨¡å—è´Ÿè´£ç®¡ç†æ··å‡åœŸæ…æ‹Œç«™çš„æ‰€æœ‰è®¾å¤‡ï¼ŒåŒ…æ‹¬è¿è¾“è½¦è¾†ï¼ˆæ…æ‹Œè½¦ã€æ³µè½¦ï¼‰ã€ç”Ÿäº§è®¾å¤‡ç­‰ã€‚æä¾›è®¾å¤‡ä¿¡æ¯ç®¡ç†ã€çŠ¶æ€ç›‘æ§ã€ç»Ÿè®¡åˆ†æç­‰åŠŸèƒ½ã€‚

**å®Œæˆæ—¶é—´**: 2026-01-26  
**çŠ¶æ€**: âœ… å·²å®Œæˆ  
**ç‰ˆæœ¬**: v1.0.0

---

## ğŸ¯ åŠŸèƒ½ç‰¹æ€§

### æ ¸å¿ƒåŠŸèƒ½

1. **è½¦è¾†ç®¡ç†**
   - âœ… åˆ›å»ºè½¦è¾†ä¿¡æ¯
   - âœ… æŸ¥è¯¢è½¦è¾†åˆ—è¡¨ï¼ˆåˆ†é¡µã€ç­›é€‰ã€æ’åºï¼‰
   - âœ… æŸ¥è¯¢å•ä¸ªè½¦è¾†è¯¦æƒ…
   - âœ… æ›´æ–°è½¦è¾†ä¿¡æ¯
   - âœ… åˆ é™¤è½¦è¾†ï¼ˆè½¯åˆ é™¤ï¼‰

2. **è½¦è¾†çŠ¶æ€ç®¡ç†**
   - âœ… 4ç§è½¦è¾†çŠ¶æ€
   - âœ… çŠ¶æ€æ›´æ–°
   - âœ… å¯ç”¨è½¦è¾†æŸ¥è¯¢

3. **è½¦è¾†ç±»å‹**
   - âœ… æ…æ‹Œè½¦ï¼ˆmixer_truckï¼‰
   - âœ… æ³µè½¦ï¼ˆpump_truckï¼‰
   - âœ… å…¶ä»–ï¼ˆotherï¼‰

4. **æ•°æ®ç»Ÿè®¡**
   - âœ… è½¦è¾†æ•°é‡ç»Ÿè®¡
   - âœ… æŒ‰çŠ¶æ€åˆ†ç»„ç»Ÿè®¡
   - âœ… æŒ‰ç±»å‹åˆ†ç»„ç»Ÿè®¡
   - âœ… æŒ‰ç«™ç‚¹ç­›é€‰

5. **è´£ä»»äººç®¡ç†**
   - âœ… åˆ†é…è½¦è¾†è´Ÿè´£äºº
   - âœ… è´Ÿè´£äººä¿¡æ¯å…³è”

6. **ä»»åŠ¡å…³è”**
   - âœ… æŸ¥çœ‹è½¦è¾†å†å²ä»»åŠ¡
   - âœ… ä»»åŠ¡æ‰§è¡Œè®°å½•

---

## ğŸ“‹ è½¦è¾†çŠ¶æ€è¯´æ˜

### çŠ¶æ€åˆ—è¡¨

| çŠ¶æ€ | è¯´æ˜ | å…è®¸çš„æ“ä½œ |
|------|------|-----------|
| `available` | å¯ç”¨ | å¯åˆ†é…ä»»åŠ¡ã€å¯ç»´æŠ¤ã€å¯ä¿®æ”¹ |
| `in_use` | ä½¿ç”¨ä¸­ | ä¸å¯åˆ é™¤ã€ä¸å¯åˆ†é…æ–°ä»»åŠ¡ |
| `maintenance` | ç»´æŠ¤ä¸­ | ä¸å¯åˆ†é…ä»»åŠ¡ã€å¯ä¿®æ”¹ |
| `broken` | æ•…éšœ | ä¸å¯åˆ†é…ä»»åŠ¡ã€éœ€è¦ç»´ä¿® |

---

## ğŸ”Œ API æ¥å£

### åŸºç¡€è·¯å¾„
```
/api/vehicles
```

### æ¥å£åˆ—è¡¨

#### 1. åˆ›å»ºè½¦è¾†
```http
POST /api/vehicles
```

**æƒé™**: admin, manager

**è¯·æ±‚ä½“**:
```json
{
  "siteId": 1,
  "licensePlate": "äº¬A12345",
  "vehicleType": "mixer_truck",
  "brand": "ä¸‰ä¸€é‡å·¥",
  "model": "SY5310GJB",
  "capacity": 10,
  "purchaseDate": "2023-01-01",
  "status": "available",
  "responsibleUserId": 1,
  "remarks": "æ–°è´­è½¦è¾†"
}
```

**å“åº”**:
```json
{
  "id": 1,
  "site_id": 1,
  "license_plate": "äº¬A12345",
  "vehicle_type": "mixer_truck",
  "brand": "ä¸‰ä¸€é‡å·¥",
  "model": "SY5310GJB",
  "capacity": 10,
  "purchase_date": "2023-01-01T00:00:00.000Z",
  "status": "available",
  "responsible_user_id": 1,
  "remarks": "æ–°è´­è½¦è¾†",
  "created_at": "2026-01-26T10:00:00.000Z",
  "site": {...},
  "responsible_user": {...},
  "creator": {...}
}
```

#### 2. æŸ¥è¯¢è½¦è¾†åˆ—è¡¨
```http
GET /api/vehicles?page=1&limit=10&status=available&vehicleType=mixer_truck
```

**æƒé™**: éœ€è¦ç™»å½•

**æŸ¥è¯¢å‚æ•°**:
- `page`: é¡µç ï¼ˆé»˜è®¤1ï¼‰
- `limit`: æ¯é¡µæ•°é‡ï¼ˆé»˜è®¤10ï¼‰
- `siteId`: ç«™ç‚¹ID
- `licensePlate`: è½¦ç‰Œå·ï¼ˆæ¨¡ç³Šæœç´¢ï¼‰
- `vehicleType`: è½¦è¾†ç±»å‹
- `status`: è½¦è¾†çŠ¶æ€
- `responsibleUserId`: è´Ÿè´£äººID
- `sortBy`: æ’åºå­—æ®µï¼ˆé»˜è®¤created_atï¼‰
- `sortOrder`: æ’åºæ–¹å‘ï¼ˆasc/descï¼Œé»˜è®¤descï¼‰

**å“åº”**:
```json
{
  "data": [...],
  "total": 100,
  "page": 1,
  "limit": 10,
  "totalPages": 10
}
```

#### 3. æŸ¥è¯¢å•ä¸ªè½¦è¾†
```http
GET /api/vehicles/:id
```

**æƒé™**: éœ€è¦ç™»å½•

**å“åº”**: åŒ…å«è½¦è¾†è¯¦æƒ…ã€è´Ÿè´£äººä¿¡æ¯ã€å†å²ä»»åŠ¡ç­‰

#### 4. æ›´æ–°è½¦è¾†
```http
PATCH /api/vehicles/:id
```

**æƒé™**: admin, manager

**è¯·æ±‚ä½“**: ä¸åˆ›å»ºè½¦è¾†ç±»ä¼¼ï¼Œæ‰€æœ‰å­—æ®µå¯é€‰

#### 5. æ›´æ–°è½¦è¾†çŠ¶æ€
```http
PATCH /api/vehicles/:id/status
```

**æƒé™**: admin, manager, operator

**è¯·æ±‚ä½“**:
```json
{
  "status": "maintenance"
}
```

#### 6. åˆ é™¤è½¦è¾†
```http
DELETE /api/vehicles/:id
```

**æƒé™**: admin, manager

**æ³¨æ„**: ä½¿ç”¨ä¸­çš„è½¦è¾†ä¸èƒ½åˆ é™¤

#### 7. è·å–è½¦è¾†ç»Ÿè®¡
```http
GET /api/vehicles/statistics?siteId=1
```

**æƒé™**: éœ€è¦ç™»å½•

**å“åº”**:
```json
{
  "totalVehicles": 50,
  "statusCount": {
    "available": 30,
    "inUse": 15,
    "maintenance": 3,
    "broken": 2
  },
  "typeCount": {
    "mixerTruck": 40,
    "pumpTruck": 10
  }
}
```

#### 8. è·å–å¯ç”¨è½¦è¾†åˆ—è¡¨
```http
GET /api/vehicles/available?siteId=1
```

**æƒé™**: éœ€è¦ç™»å½•

**å“åº”**: è¿”å›æ‰€æœ‰çŠ¶æ€ä¸ºavailableçš„è½¦è¾†åˆ—è¡¨

---

## ğŸ“ æ–‡ä»¶ç»“æ„

```
concrete-plant-api/src/vehicles/
â”œâ”€â”€ dto/
â”‚   â”œâ”€â”€ create-vehicle.dto.ts          # åˆ›å»ºè½¦è¾†DTO
â”‚   â”œâ”€â”€ update-vehicle.dto.ts          # æ›´æ–°è½¦è¾†DTO
â”‚   â”œâ”€â”€ query-vehicle.dto.ts           # æŸ¥è¯¢è½¦è¾†DTO
â”‚   â””â”€â”€ update-vehicle-status.dto.ts   # æ›´æ–°çŠ¶æ€DTO
â”œâ”€â”€ vehicles.controller.ts             # è½¦è¾†æ§åˆ¶å™¨
â”œâ”€â”€ vehicles.service.ts                # è½¦è¾†æœåŠ¡
â””â”€â”€ vehicles.module.ts                 # è½¦è¾†æ¨¡å—
```

---

## ğŸ”’ æƒé™æ§åˆ¶

### è§’è‰²æƒé™çŸ©é˜µ

| æ“ä½œ | admin | manager | operator | driver | quality |
|------|-------|---------|----------|--------|---------|
| åˆ›å»ºè½¦è¾† | âœ… | âœ… | âŒ | âŒ | âŒ |
| æŸ¥è¯¢è½¦è¾† | âœ… | âœ… | âœ… | âœ… | âœ… |
| æ›´æ–°è½¦è¾† | âœ… | âœ… | âŒ | âŒ | âŒ |
| æ›´æ–°çŠ¶æ€ | âœ… | âœ… | âœ… | âŒ | âŒ |
| åˆ é™¤è½¦è¾† | âœ… | âœ… | âŒ | âŒ | âŒ |
| æŸ¥çœ‹ç»Ÿè®¡ | âœ… | âœ… | âœ… | âœ… | âœ… |

---

## âœ… æ•°æ®éªŒè¯

### åˆ›å»ºè½¦è¾†éªŒè¯è§„åˆ™

| å­—æ®µ | ç±»å‹ | å¿…å¡« | éªŒè¯è§„åˆ™ |
|------|------|------|---------|
| siteId | number | âœ… | å¿…é¡»å­˜åœ¨çš„ç«™ç‚¹ID |
| licensePlate | string | âœ… | ä¸èƒ½ä¸ºç©ºï¼ŒåŒç«™ç‚¹å†…å”¯ä¸€ |
| vehicleType | enum | âœ… | mixer_truck/pump_truck/other |
| brand | string | âŒ | - |
| model | string | âŒ | - |
| capacity | number | âŒ | å¿…é¡»å¤§äºç­‰äº0 |
| purchaseDate | date | âŒ | ISO 8601æ ¼å¼ |
| status | enum | âŒ | available/in_use/maintenance/brokenï¼Œé»˜è®¤available |
| responsibleUserId | number | âŒ | å¦‚æœæä¾›ï¼Œå¿…é¡»å­˜åœ¨çš„ç”¨æˆ·ID |
| remarks | string | âŒ | - |

---

## ğŸ”„ ä¸šåŠ¡æµç¨‹

### è½¦è¾†ç”Ÿå‘½å‘¨æœŸ

```
1. è½¦è¾†é‡‡è´­
   â†“
2. å½•å…¥ç³»ç»Ÿï¼ˆavailableçŠ¶æ€ï¼‰
   â†“
3. åˆ†é…è´Ÿè´£äºº
   â†“
4. åˆ†é…ä»»åŠ¡ï¼ˆavailable â†’ in_useï¼‰
   â†“
5. æ‰§è¡Œä»»åŠ¡
   â†“
6. ä»»åŠ¡å®Œæˆï¼ˆin_use â†’ availableï¼‰
   â†“
7. å®šæœŸç»´æŠ¤ï¼ˆavailable â†’ maintenanceï¼‰
   â†“
8. ç»´æŠ¤å®Œæˆï¼ˆmaintenance â†’ availableï¼‰
```

### æ•…éšœå¤„ç†æµç¨‹

```
è½¦è¾†æ•…éšœ
   â†“
æ›´æ–°çŠ¶æ€ä¸ºbroken
   â†“
ç»´ä¿®å¤„ç†
   â†“
æ›´æ–°çŠ¶æ€ä¸ºmaintenance
   â†“
ç»´ä¿®å®Œæˆ
   â†“
æ›´æ–°çŠ¶æ€ä¸ºavailable
```

---

## ğŸ“Š æ•°æ®åº“å…³ç³»

### å…³è”è¡¨

- `vehicles` - è½¦è¾†ä¸»è¡¨
- `sites` - ç«™ç‚¹è¡¨
- `users` - ç”¨æˆ·è¡¨ï¼ˆè´Ÿè´£äººã€åˆ›å»ºäººï¼‰
- `tasks` - ä»»åŠ¡è¡¨

### å¤–é”®å…³ç³»

```sql
vehicles.site_id â†’ sites.id
vehicles.responsible_user_id â†’ users.id
vehicles.created_by â†’ users.id
tasks.vehicle_id â†’ vehicles.id
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### ä¸šåŠ¡è§„åˆ™

1. **è½¦ç‰Œå·å”¯ä¸€æ€§**: åŒä¸€ç«™ç‚¹å†…è½¦ç‰Œå·å¿…é¡»å”¯ä¸€
2. **åˆ é™¤é™åˆ¶**: ä½¿ç”¨ä¸­çš„è½¦è¾†ä¸èƒ½åˆ é™¤
3. **çŠ¶æ€ç®¡ç†**: ä»»åŠ¡ç³»ç»Ÿä¼šè‡ªåŠ¨æ›´æ–°è½¦è¾†çŠ¶æ€
4. **è´Ÿè´£äººéªŒè¯**: åˆ†é…è´Ÿè´£äººæ—¶å¿…é¡»éªŒè¯ç”¨æˆ·å­˜åœ¨æ€§

### æ€§èƒ½ä¼˜åŒ–

1. **åˆ†é¡µæŸ¥è¯¢**: é»˜è®¤æ¯é¡µ10æ¡ï¼Œå»ºè®®ä¸è¶…è¿‡100æ¡
2. **ç´¢å¼•ä¼˜åŒ–**: è½¦ç‰Œå·ã€çŠ¶æ€ã€ç«™ç‚¹IDå·²å»ºç«‹ç´¢å¼•
3. **å…³è”æŸ¥è¯¢**: ä½¿ç”¨ Prisma include ä¼˜åŒ–å…³è”æŸ¥è¯¢
4. **è½¯åˆ é™¤**: ä½¿ç”¨ deleted_at å­—æ®µå®ç°è½¯åˆ é™¤

---

## ğŸš€ åç»­ä¼˜åŒ–å»ºè®®

### çŸ­æœŸä¼˜åŒ–

1. **GPSè¿½è¸ª**: é›†æˆGPSå®æ—¶ä½ç½®è¿½è¸ª
2. **ç»´æŠ¤è®°å½•**: æ·»åŠ ç»´æŠ¤ä¿å…»è®°å½•
3. **æ²¹è€—ç»Ÿè®¡**: è®°å½•å’Œç»Ÿè®¡æ²¹è€—æ•°æ®
4. **è¡Œé©¶é‡Œç¨‹**: è®°å½•è½¦è¾†è¡Œé©¶é‡Œç¨‹

### ä¸­æœŸä¼˜åŒ–

5. **ç”µå­å›´æ **: è®¾ç½®è½¦è¾†æ´»åŠ¨èŒƒå›´
6. **é¢„è­¦ç³»ç»Ÿ**: ç»´æŠ¤åˆ°æœŸæé†’ã€å¹´æ£€æé†’
7. **æˆæœ¬æ ¸ç®—**: è½¦è¾†è¿è¥æˆæœ¬ç»Ÿè®¡
8. **æ•ˆç‡åˆ†æ**: è½¦è¾†ä½¿ç”¨æ•ˆç‡åˆ†æ

### é•¿æœŸä¼˜åŒ–

9. **æ™ºèƒ½è°ƒåº¦**: AIä¼˜åŒ–è½¦è¾†è°ƒåº¦
10. **é¢„æµ‹æ€§ç»´æŠ¤**: åŸºäºæ•°æ®é¢„æµ‹ç»´æŠ¤éœ€æ±‚
11. **è½¦è”ç½‘**: æ¥å…¥è½¦è”ç½‘å¹³å°
12. **ç§»åŠ¨ç«¯**: å¸æœºç«¯è½¦è¾†ç®¡ç†åº”ç”¨

---

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### å‰ç«¯é›†æˆç¤ºä¾‹

```typescript
// åˆ›å»ºè½¦è¾†
const createVehicle = async (vehicleData) => {
  const response = await fetch('/api/vehicles', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${token}`,
    },
    body: JSON.stringify(vehicleData),
  });
  return response.json();
};

// æŸ¥è¯¢å¯ç”¨è½¦è¾†
const fetchAvailableVehicles = async (siteId) => {
  const response = await fetch(`/api/vehicles/available?siteId=${siteId}`, {
    headers: {
      'Authorization': `Bearer ${token}`,
    },
  });
  return response.json();
};

// æ›´æ–°è½¦è¾†çŠ¶æ€
const updateVehicleStatus = async (vehicleId, status) => {
  const response = await fetch(`/api/vehicles/${vehicleId}/status`, {
    method: 'PATCH',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${token}`,
    },
    body: JSON.stringify({ status }),
  });
  return response.json();
};
```

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ï¼š
- å®Œæ•´æ–‡æ¡£ï¼š`VEHICLES_MODULE_README.md`
- æµ‹è¯•è„šæœ¬ï¼š`test-scripts/test-vehicles.sh`ï¼ˆå¾…åˆ›å»ºï¼‰
- APIæ–‡æ¡£ï¼š`/api/docs`ï¼ˆå¦‚å·²é…ç½®Swaggerï¼‰

---

**æœ€åæ›´æ–°**: 2026-01-26  
**ç‰ˆæœ¬**: v1.0.0  
**çŠ¶æ€**: âœ… ç”Ÿäº§å°±ç»ª
