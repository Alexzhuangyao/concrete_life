# é…æ–¹ç®¡ç†æ¨¡å—æ–‡æ¡£

## ğŸ“¦ æ¨¡å—æ¦‚è¿°

é…æ–¹ç®¡ç†æ¨¡å—è´Ÿè´£ç®¡ç†æ··å‡åœŸé…æ–¹ï¼ŒåŒ…æ‹¬é…æ–¹ä¿¡æ¯ã€é…æ–¹æ˜ç»†ã€æ··å‡åœŸç­‰çº§ç­‰ã€‚æä¾›é…æ–¹CRUDã€ç‰ˆæœ¬ç®¡ç†ã€å‘å¸ƒå½’æ¡£ç­‰åŠŸèƒ½ã€‚

**å®Œæˆæ—¶é—´**: 2026-01-26  
**çŠ¶æ€**: âœ… å·²å®Œæˆ  
**ç‰ˆæœ¬**: v1.0.0

---

## ğŸ¯ åŠŸèƒ½ç‰¹æ€§

### æ ¸å¿ƒåŠŸèƒ½

1. **é…æ–¹ç®¡ç†**
   - âœ… åˆ›å»ºé…æ–¹
   - âœ… æŸ¥è¯¢é…æ–¹åˆ—è¡¨ï¼ˆåˆ†é¡µã€ç­›é€‰ã€æ’åºï¼‰
   - âœ… æŸ¥è¯¢å•ä¸ªé…æ–¹è¯¦æƒ…
   - âœ… æ›´æ–°é…æ–¹ä¿¡æ¯
   - âœ… åˆ é™¤é…æ–¹ï¼ˆè½¯åˆ é™¤ï¼‰
   - âœ… é…æ–¹ç»Ÿè®¡

2. **é…æ–¹çŠ¶æ€ç®¡ç†**
   - âœ… è‰ç¨¿ï¼ˆdraftï¼‰
   - âœ… å·²å‘å¸ƒï¼ˆpublishedï¼‰
   - âœ… å·²å½’æ¡£ï¼ˆarchivedï¼‰
   - âœ… çŠ¶æ€æµè½¬æ§åˆ¶

3. **é…æ–¹ç‰ˆæœ¬ç®¡ç†**
   - âœ… ç‰ˆæœ¬å·ç®¡ç†
   - âœ… å¤åˆ¶é…æ–¹ï¼ˆåˆ›å»ºæ–°ç‰ˆæœ¬ï¼‰
   - âœ… ç‰ˆæœ¬å†å²è¿½è¸ª

4. **é…æ–¹æ˜ç»†ç®¡ç†**
   - âœ… ææ–™é…æ¯”
   - âœ… è¯¯å·®å®¹å¿åº¦
   - âœ… æ˜ç»†å…³è”æŸ¥è¯¢

5. **æ··å‡åœŸç­‰çº§ç®¡ç†**
   - âœ… ç­‰çº§CRUD
   - âœ… å¼ºåº¦ç®¡ç†
   - âœ… ä»·æ ¼ç®¡ç†
   - âœ… ç­‰çº§ç»Ÿè®¡

---

## ğŸ“‹ é…æ–¹çŠ¶æ€è¯´æ˜

### çŠ¶æ€åˆ—è¡¨

| çŠ¶æ€ | è¯´æ˜ | å…è®¸çš„æ“ä½œ |
|------|------|-----------|
| `draft` | è‰ç¨¿ | å¯ä¿®æ”¹ã€å¯åˆ é™¤ã€å¯å‘å¸ƒ |
| `published` | å·²å‘å¸ƒ | åªèƒ½å½’æ¡£ã€ä¸å¯ä¿®æ”¹ã€ä¸å¯åˆ é™¤ |
| `archived` | å·²å½’æ¡£ | ä¸å¯ä¿®æ”¹ã€ä¸å¯åˆ é™¤ |

### çŠ¶æ€æµè½¬

```
draft â†’ published â†’ archived
  â†“
åˆ é™¤
```

---

## ğŸ”Œ API æ¥å£

### é…æ–¹ç®¡ç†æ¥å£

#### åŸºç¡€è·¯å¾„: `/api/recipes`

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ | æƒé™ |
|------|------|------|------|
| POST | `/api/recipes` | åˆ›å»ºé…æ–¹ | admin, manager |
| GET | `/api/recipes` | æŸ¥è¯¢é…æ–¹åˆ—è¡¨ | éœ€ç™»å½• |
| GET | `/api/recipes/statistics` | è·å–é…æ–¹ç»Ÿè®¡ | éœ€ç™»å½• |
| GET | `/api/recipes/:id` | æŸ¥è¯¢å•ä¸ªé…æ–¹ | éœ€ç™»å½• |
| PATCH | `/api/recipes/:id` | æ›´æ–°é…æ–¹ | admin, manager |
| PATCH | `/api/recipes/:id/publish` | å‘å¸ƒé…æ–¹ | admin, manager |
| PATCH | `/api/recipes/:id/archive` | å½’æ¡£é…æ–¹ | admin, manager |
| POST | `/api/recipes/:id/copy` | å¤åˆ¶é…æ–¹ | admin, manager |
| DELETE | `/api/recipes/:id` | åˆ é™¤é…æ–¹ | admin, manager |

### æ··å‡åœŸç­‰çº§æ¥å£

#### åŸºç¡€è·¯å¾„: `/api/grades`

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ | æƒé™ |
|------|------|------|------|
| POST | `/api/grades` | åˆ›å»ºç­‰çº§ | admin, manager |
| GET | `/api/grades` | æŸ¥è¯¢ç­‰çº§åˆ—è¡¨ | éœ€ç™»å½• |
| GET | `/api/grades/statistics` | è·å–ç­‰çº§ç»Ÿè®¡ | éœ€ç™»å½• |
| GET | `/api/grades/:id` | æŸ¥è¯¢å•ä¸ªç­‰çº§ | éœ€ç™»å½• |
| PATCH | `/api/grades/:id` | æ›´æ–°ç­‰çº§ | admin, manager |
| DELETE | `/api/grades/:id` | åˆ é™¤ç­‰çº§ | admin, manager |

---

## ğŸ“ è¯·æ±‚ç¤ºä¾‹

### 1. åˆ›å»ºæ··å‡åœŸç­‰çº§

```bash
POST /api/grades
```

**è¯·æ±‚ä½“**:
```json
{
  "name": "C30",
  "code": "C30",
  "strength": 30,
  "price": 350,
  "description": "æ™®é€šæ··å‡åœŸï¼Œé€‚ç”¨äºä¸€èˆ¬å»ºç­‘"
}
```

### 2. åˆ›å»ºé…æ–¹

```bash
POST /api/recipes
```

**è¯·æ±‚ä½“**:
```json
{
  "siteId": 1,
  "name": "C30æ ‡å‡†é…æ–¹",
  "code": "C30-001",
  "gradeId": 1,
  "version": "1.0",
  "status": "draft",
  "slump": 180,
  "strength": 30,
  "waterCementRatio": 0.45,
  "totalWeight": 2400,
  "details": [
    {
      "materialId": 1,
      "quantity": 350,
      "tolerance": 5,
      "remarks": "æ°´æ³¥"
    },
    {
      "materialId": 2,
      "quantity": 700,
      "tolerance": 10,
      "remarks": "ç ‚"
    },
    {
      "materialId": 3,
      "quantity": 1150,
      "tolerance": 15,
      "remarks": "çŸ³å­"
    },
    {
      "materialId": 4,
      "quantity": 175,
      "tolerance": 3,
      "remarks": "æ°´"
    }
  ],
  "remarks": "æ ‡å‡†C30é…æ–¹"
}
```

### 3. å‘å¸ƒé…æ–¹

```bash
PATCH /api/recipes/1/publish
```

### 4. å¤åˆ¶é…æ–¹ï¼ˆåˆ›å»ºæ–°ç‰ˆæœ¬ï¼‰

```bash
POST /api/recipes/1/copy
```

---

## ğŸ“ æ–‡ä»¶ç»“æ„

```
concrete-plant-api/src/
â”œâ”€â”€ recipes/
â”‚   â”œâ”€â”€ dto/
â”‚   â”‚   â”œâ”€â”€ create-recipe.dto.ts
â”‚   â”‚   â”œâ”€â”€ update-recipe.dto.ts
â”‚   â”‚   â””â”€â”€ query-recipe.dto.ts
â”‚   â”œâ”€â”€ recipes.controller.ts
â”‚   â”œâ”€â”€ recipes.service.ts
â”‚   â””â”€â”€ recipes.module.ts
â”‚
â””â”€â”€ grades/
    â”œâ”€â”€ dto/
    â”‚   â”œâ”€â”€ create-grade.dto.ts
    â”‚   â”œâ”€â”€ update-grade.dto.ts
    â”‚   â””â”€â”€ query-grade.dto.ts
    â”œâ”€â”€ grades.controller.ts
    â”œâ”€â”€ grades.service.ts
    â””â”€â”€ grades.module.ts
```

---

## ğŸ”’ æƒé™æ§åˆ¶

### è§’è‰²æƒé™çŸ©é˜µ

| æ“ä½œ | admin | manager | operator | driver | quality |
|------|-------|---------|----------|--------|---------|
| åˆ›å»ºé…æ–¹ | âœ… | âœ… | âŒ | âŒ | âŒ |
| æŸ¥è¯¢é…æ–¹ | âœ… | âœ… | âœ… | âœ… | âœ… |
| æ›´æ–°é…æ–¹ | âœ… | âœ… | âŒ | âŒ | âŒ |
| åˆ é™¤é…æ–¹ | âœ… | âœ… | âŒ | âŒ | âŒ |
| å‘å¸ƒé…æ–¹ | âœ… | âœ… | âŒ | âŒ | âŒ |
| ç®¡ç†ç­‰çº§ | âœ… | âœ… | âŒ | âŒ | âŒ |

---

## âœ… æ•°æ®éªŒè¯

### åˆ›å»ºé…æ–¹éªŒè¯è§„åˆ™

| å­—æ®µ | ç±»å‹ | å¿…å¡« | éªŒè¯è§„åˆ™ |
|------|------|------|---------|
| siteId | number | âœ… | å¿…é¡»å­˜åœ¨çš„ç«™ç‚¹ID |
| name | string | âœ… | ä¸èƒ½ä¸ºç©ºï¼ŒåŒç«™ç‚¹å†…å”¯ä¸€ |
| code | string | âŒ | - |
| gradeId | number | âŒ | å¦‚æœæä¾›ï¼Œå¿…é¡»å­˜åœ¨çš„ç­‰çº§ID |
| version | string | âŒ | é»˜è®¤"1.0" |
| status | enum | âŒ | draft/published/archivedï¼Œé»˜è®¤draft |
| slump | number | âŒ | åè½åº¦ï¼Œå¿…é¡»å¤§äºç­‰äº0 |
| strength | number | âŒ | å¼ºåº¦ï¼Œå¿…é¡»å¤§äºç­‰äº0 |
| waterCementRatio | number | âŒ | æ°´ç°æ¯”ï¼Œå¿…é¡»å¤§äºç­‰äº0 |
| totalWeight | number | âŒ | æ€»é‡é‡ï¼Œå¿…é¡»å¤§äºç­‰äº0 |
| details | array | âŒ | é…æ–¹æ˜ç»†æ•°ç»„ |

---

## ğŸ”„ ä¸šåŠ¡æµç¨‹

### é…æ–¹åˆ›å»ºæµç¨‹

```
1. åˆ›å»ºæ··å‡åœŸç­‰çº§
   â†“
2. åˆ›å»ºé…æ–¹ï¼ˆè‰ç¨¿çŠ¶æ€ï¼‰
   â†“
3. æ·»åŠ é…æ–¹æ˜ç»†ï¼ˆææ–™é…æ¯”ï¼‰
   â†“
4. æµ‹è¯•éªŒè¯é…æ–¹
   â†“
5. å‘å¸ƒé…æ–¹
   â†“
6. é…æ–¹æŠ•å…¥ä½¿ç”¨
```

### é…æ–¹ç‰ˆæœ¬ç®¡ç†æµç¨‹

```
1. ç°æœ‰é…æ–¹éœ€è¦è°ƒæ•´
   â†“
2. å¤åˆ¶é…æ–¹ï¼ˆåˆ›å»ºæ–°ç‰ˆæœ¬ï¼‰
   â†“
3. ä¿®æ”¹æ–°ç‰ˆæœ¬é…æ–¹
   â†“
4. æµ‹è¯•éªŒè¯æ–°ç‰ˆæœ¬
   â†“
5. å‘å¸ƒæ–°ç‰ˆæœ¬
   â†“
6. å½’æ¡£æ—§ç‰ˆæœ¬
```

---

## ğŸ“Š æ•°æ®åº“å…³ç³»

### å…³è”è¡¨

- `recipes` - é…æ–¹ä¸»è¡¨
- `recipe_details` - é…æ–¹æ˜ç»†è¡¨
- `concrete_grades` - æ··å‡åœŸç­‰çº§è¡¨
- `materials` - ææ–™è¡¨
- `sites` - ç«™ç‚¹è¡¨
- `users` - ç”¨æˆ·è¡¨

### å¤–é”®å…³ç³»

```sql
recipes.site_id â†’ sites.id
recipes.grade_id â†’ concrete_grades.id
recipes.created_by â†’ users.id
recipe_details.recipe_id â†’ recipes.id
recipe_details.material_id â†’ materials.id
concrete_grades.created_by â†’ users.id
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### ä¸šåŠ¡è§„åˆ™

1. **é…æ–¹åç§°å”¯ä¸€æ€§**: åŒä¸€ç«™ç‚¹å†…é…æ–¹åç§°å¿…é¡»å”¯ä¸€
2. **å‘å¸ƒé™åˆ¶**: å·²å‘å¸ƒçš„é…æ–¹ä¸èƒ½ä¿®æ”¹å’Œåˆ é™¤
3. **åˆ é™¤é™åˆ¶**: åªèƒ½åˆ é™¤è‰ç¨¿çŠ¶æ€çš„é…æ–¹
4. **æ˜ç»†éªŒè¯**: å‘å¸ƒé…æ–¹æ—¶å¿…é¡»æœ‰é…æ–¹æ˜ç»†
5. **ç­‰çº§åˆ é™¤**: æœ‰å…³è”é…æ–¹çš„ç­‰çº§ä¸èƒ½åˆ é™¤
6. **ç‰ˆæœ¬ç®¡ç†**: å¤åˆ¶é…æ–¹æ—¶è‡ªåŠ¨ç”Ÿæˆæ–°ç‰ˆæœ¬å·

### æ€§èƒ½ä¼˜åŒ–

1. **åˆ†é¡µæŸ¥è¯¢**: é»˜è®¤æ¯é¡µ10æ¡
2. **ç´¢å¼•ä¼˜åŒ–**: é…æ–¹åç§°ã€ç¼–ç ã€çŠ¶æ€å·²å»ºç«‹ç´¢å¼•
3. **äº‹åŠ¡å¤„ç†**: åˆ›å»ºé…æ–¹å’Œæ˜ç»†ä½¿ç”¨äº‹åŠ¡
4. **è½¯åˆ é™¤**: ä½¿ç”¨ deleted_at å­—æ®µ

---

## ğŸš€ åç»­ä¼˜åŒ–å»ºè®®

### çŸ­æœŸä¼˜åŒ–

1. **é…æ–¹è®¡ç®—**: è‡ªåŠ¨è®¡ç®—é…æ–¹æ€»é‡é‡
2. **é…æ–¹éªŒè¯**: éªŒè¯é…æ–¹åˆç†æ€§
3. **é…æ–¹æ¨¡æ¿**: å¸¸ç”¨é…æ–¹æ¨¡æ¿
4. **æ‰¹é‡å¯¼å…¥**: æ‰¹é‡å¯¼å…¥é…æ–¹

### ä¸­æœŸä¼˜åŒ–

5. **é…æ–¹å¯¹æ¯”**: ä¸åŒç‰ˆæœ¬é…æ–¹å¯¹æ¯”
6. **æˆæœ¬è®¡ç®—**: æ ¹æ®ææ–™ä»·æ ¼è®¡ç®—é…æ–¹æˆæœ¬
7. **é…æ–¹æ¨è**: åŸºäºå†å²æ•°æ®æ¨èé…æ–¹
8. **é…æ–¹å®¡æ‰¹**: é…æ–¹å®¡æ‰¹æµç¨‹

### é•¿æœŸä¼˜åŒ–

9. **AIä¼˜åŒ–**: AIä¼˜åŒ–é…æ–¹é…æ¯”
10. **è´¨é‡è¿½æº¯**: é…æ–¹è´¨é‡è¿½æº¯
11. **ç§»åŠ¨ç«¯**: ç§»åŠ¨ç«¯é…æ–¹æŸ¥çœ‹
12. **é…æ–¹åˆ†äº«**: ç«™ç‚¹é—´é…æ–¹åˆ†äº«

---

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### å‰ç«¯é›†æˆç¤ºä¾‹

```typescript
// åˆ›å»ºé…æ–¹
const createRecipe = async (recipeData) => {
  const response = await fetch('/api/recipes', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${token}`,
    },
    body: JSON.stringify(recipeData),
  });
  return response.json();
};

// å‘å¸ƒé…æ–¹
const publishRecipe = async (recipeId) => {
  const response = await fetch(`/api/recipes/${recipeId}/publish`, {
    method: 'PATCH',
    headers: {
      'Authorization': `Bearer ${token}`,
    },
  });
  return response.json();
};

// å¤åˆ¶é…æ–¹
const copyRecipe = async (recipeId) => {
  const response = await fetch(`/api/recipes/${recipeId}/copy`, {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${token}`,
    },
  });
  return response.json();
};
```

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ï¼š
- å®Œæ•´æ–‡æ¡£ï¼š`RECIPES_MODULE_README.md`
- æµ‹è¯•è„šæœ¬ï¼š`test-scripts/test-recipes.sh`ï¼ˆå¾…åˆ›å»ºï¼‰
- APIæ–‡æ¡£ï¼š`/api/docs`ï¼ˆå¦‚å·²é…ç½®Swaggerï¼‰

---

**æœ€åæ›´æ–°**: 2026-01-26  
**ç‰ˆæœ¬**: v1.0.0  
**çŠ¶æ€**: âœ… å¼€å‘å®Œæˆï¼Œå¾…æµ‹è¯•
