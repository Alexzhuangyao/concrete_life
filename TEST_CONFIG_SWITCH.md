# 配置切换功能测试指南

## 🎯 测试目标

验证开发模式下的配置切换功能是否正常工作，以及界面是否正确显示配置变化。

## 📋 测试步骤

### 1. 启动应用

```bash
# 启动前端
cd concrete-plant-web
npm run dev

# 启动后端（另一个终端）
cd concrete-plant-api
npm run start:dev
```

### 2. 查看初始状态

打开浏览器访问 `http://localhost:5173`

**预期效果：**
- ✅ 侧边栏顶部显示：`混凝土管控平台  💻 开发 ⚙️`
- ✅ 页面顶部显示配置状态横幅（黄色/橙色警告框）
- ✅ 横幅内容：`当前配置：混合模式 - 使用默认配置，点击侧边栏徽章可切换配置`

### 3. 切换到本地模式

**操作：**
1. 点击侧边栏顶部的 `💻 开发 ⚙️` 徽章
2. 在弹出的对话框中选择 `🖥️ 本地模式 (Edge)`
3. 点击 `应用并刷新` 按钮
4. 等待页面自动刷新

**预期效果：**
- ✅ 页面刷新后，配置横幅变为绿色
- ✅ 横幅显示：`当前配置：本地模式 - 使用 SQLite 数据库，启用 PLC 通信和云端同步功能`
- ✅ 显示标签：
  - `SQLITE` (绿色)
  - `PLC通信` (绿色勾选)
  - `云端同步` (绿色勾选)

### 4. 切换到云端模式

**操作：**
1. 再次点击侧边栏顶部的 `💻 开发 ⚙️` 徽章
2. 在弹出的对话框中选择 `☁️ 云端模式 (Cloud)`
3. 点击 `应用并刷新` 按钮
4. 等待页面自动刷新

**预期效果：**
- ✅ 页面刷新后，配置横幅变为蓝色
- ✅ 横幅显示：`当前配置：云端模式 - 使用 PostgreSQL 数据库，启用多站点管理和高级分析功能`
- ✅ 显示标签：
  - `POSTGRES` (蓝色)
  - `多站点管理` (绿色勾选)
  - `高级分析` (绿色勾选)

### 5. 重置配置

**操作：**
1. 点击侧边栏顶部的 `💻 开发 ⚙️` 徽章
2. 在弹出的对话框中点击 `重置默认` 按钮
3. 等待页面自动刷新

**预期效果：**
- ✅ 页面刷新后，配置横幅恢复为黄色/橙色
- ✅ 横幅显示：`当前配置：混合模式`

## 🔍 详细验证点

### 配置横幅样式对比

| 模式 | 颜色 | 图标 | 数据库标签 | 功能标签 |
|------|------|------|-----------|---------|
| 混合模式 | 黄色/橙色 | ℹ️ | - | - |
| 本地模式 | 绿色 | 🔌 | SQLITE (绿色) | PLC通信, 云端同步 |
| 云端模式 | 蓝色 | ☁️ | POSTGRES (蓝色) | 多站点管理, 高级分析 |

### 配置切换对话框

**对话框标题：** `⚙️ 开发模式配置切换`

**本地模式选项：**
```
○ 🖥️ 本地模式 (Edge)
  • 使用 SQLite 数据库
  • 启用 PLC 通信功能
  • 启用云端同步功能
  • 模拟边缘设备部署场景
```

**云端模式选项：**
```
○ ☁️ 云端模式 (Cloud)
  • 使用 PostgreSQL 数据库
  • 启用多站点管理
  • 启用高级分析功能
  • 模拟云端服务器部署场景
```

## 🐛 常见问题排查

### 问题 1：点击徽章没有反应

**可能原因：**
- 徽章没有显示齿轮图标 ⚙️
- 当前不是开发模式

**解决方法：**
```bash
# 检查浏览器控制台
# 应该看到类似的日志：
# [DevMode] 使用开发配置: edge
```

### 问题 2：切换后横幅没有变化

**可能原因：**
- localStorage 没有正确保存
- 页面没有刷新

**解决方法：**
```javascript
// 在浏览器控制台执行
console.log(localStorage.getItem('dev_config_mode'));
// 应该输出: "edge" 或 "cloud"

// 手动刷新
location.reload();
```

### 问题 3：横幅不显示

**可能原因：**
- 组件导入错误
- 后端 API 未响应

**解决方法：**
```javascript
// 在浏览器控制台执行
fetch('/api/config/runtime')
  .then(r => r.json())
  .then(config => console.log('Config:', config));
```

## 📊 测试检查清单

- [ ] 侧边栏徽章显示 `💻 开发 ⚙️`
- [ ] 徽章可点击，鼠标悬停显示提示
- [ ] 点击徽章打开配置切换对话框
- [ ] 对话框显示两个模式选项
- [ ] 可以选择本地模式
- [ ] 可以选择云端模式
- [ ] 点击"应用并刷新"后页面自动刷新
- [ ] 刷新后配置横幅显示正确的模式
- [ ] 横幅显示正确的数据库类型
- [ ] 横幅显示正确的功能标签
- [ ] 横幅颜色与模式匹配
- [ ] 可以关闭横幅（点击 X）
- [ ] 可以重置配置到默认状态
- [ ] Dashboard 页面显示横幅
- [ ] Sites 页面显示横幅

## 🎨 视觉效果示例

### 本地模式（绿色）
```
┌────────────────────────────────────────────────────────────────┐
│ 🔌 当前配置：本地模式                                            │
│    使用 SQLite 数据库，启用 PLC 通信和云端同步功能                │
│                                                                 │
│    [SQLITE] [✓ PLC通信] [✓ 云端同步]                      [×]  │
└────────────────────────────────────────────────────────────────┘
```

### 云端模式（蓝色）
```
┌────────────────────────────────────────────────────────────────┐
│ ☁️ 当前配置：云端模式                                            │
│    使用 PostgreSQL 数据库，启用多站点管理和高级分析功能          │
│                                                                 │
│    [POSTGRES] [✓ 多站点管理] [✓ 高级分析]                 [×]  │
└────────────────────────────────────────────────────────────────┘
```

## 🚀 下一步

测试通过后，您可以：

1. **在其他页面添加横幅** - 让更多页面显示配置状态
2. **根据配置显示/隐藏功能** - 使用 `useFeature` Hook
3. **添加更多配置选项** - 扩展配置切换器
4. **持久化用户偏好** - 保存到后端数据库

## 📝 测试报告模板

```
测试日期：____________________
测试人员：____________________

测试结果：
□ 通过  □ 失败

问题描述：
_________________________________
_________________________________

截图：
[附上测试截图]
```

---

**提示：** 如果所有测试都通过，说明配置切换功能已经完美工作！🎉
